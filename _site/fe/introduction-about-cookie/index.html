<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cookie简介</title>

  <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive.css">

	

	

</head>
<body id="top-of-page" class="post">
	
	<div id="navigation" class="sticky">
  <nav class="top-bar" role="navigation" data-topbar>
    <ul class="title-area">
      <li class="name">
      <h1 class="show-for-small-only"><a href="http://localhost:4000" class="icon-tree"> 安富宝前端技术博客</a></h1>
    </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span>Nav</span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        

              

          
          
        

              

          
          
        
        
      </ul>

      <ul class="left">
        

              

          
          

            
            
              <li><a  href="http://localhost:4000/">安富保FE</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          

            
            
              <li><a  href="http://localhost:4000/archive/">归档</a></li>
              <li class="divider"></li>

            
            
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->

	

	




	<div class="row t30">
	<div class="medium-8 columns medium-offset-2 end">
		<article itemscope itemtype="http://schema.org/Article">
			<header>
				

				<div itemprop="name">
					<p class="subheadline">一篇简单的cookie介绍</p>
					<h1>Cookie简介</h1>
				</div>
			</header>


			
			<p class="teaser" itemprop="description">
				cookie是一种本地存储，用于区分客户端，辨别用户状态，在HTTP中广泛使用。作为前端工程师一定要了解的一个方面知识，cookie在前端知识点中也占据了非常重要的地位。
			</p>
			

			<div itemprop="articleSection">
			<h4 id="一个例子">一个例子</h4>

<p>用js设置一个cookie</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s1">'name=value; domain=.afb.com; expires=Mon, 24 Jul 2018 09:36:46 GMT; path=/; secure'</span>
</code></pre>
</div>
<p>这里进行了一个cookie设置操作，参数有<code class="highlighter-rouge">name</code>, <code class="highlighter-rouge">domain</code>, <code class="highlighter-rouge">expries</code>, <code class="highlighter-rouge">path</code>, <code class="highlighter-rouge">secure</code>这些。参数之间用分号<code class="highlighter-rouge">;</code>链接</p>

<h4 id="参数">参数</h4>

<ul>
  <li>
    <h5 id="path">path</h5>

    <ul>
      <li>path默认值为当前文档位置的路径</li>
      <li>可以设置成根目录’/’，所有的子目录都可以访问</li>
    </ul>
  </li>
  <li>
    <h5 id="domain">domain</h5>

    <ul>
      <li>domain默认为当前文档位置的路径的域名部分</li>
      <li>可以设置成’.domain.com’，主域名和所有的子域名(m.news.domain.com,m.domain.com)都可以访问到</li>
      <li>如果设置成’.news.domain.com’，其子域名(m.news.domain.com)可以访问到</li>
      <li>可以设置成’.domain.com’，主域名和所有的子域名(www.domain.com,m.domain.com)都可以访问到</li>
      <li>尽量不要用’domain.com’这样的值</li>
    </ul>
  </li>
  <li>
    <h5 id="max-age-和-expires">max-age 和 expires</h5>

    <ul>
      <li>max-age 单位秒，默认为-1，值为过期时长 (例如一年为60<em>60</em>24*365)</li>
      <li>max-age IE低版本不支持，统一换算成 expires (当前时间+max-age)</li>
      <li>expires 不指定时，会话结束后过期</li>
      <li>expires 格式应为UTC时间，这个值的格式参见Date.toUTCString()</li>
    </ul>
  </li>
  <li>
    <h5 id="secure">secure</h5>

    <ul>
      <li>secure (cookie只通过https协议传输)</li>
    </ul>
  </li>
  <li>
    <h5 id="httponly">httpOnly</h5>

    <ul>
      <li>httpOnly (服务端用，前端无法取到)</li>
    </ul>
  </li>
  <li>
    <h5 id="namevalue">name=value</h5>

    <ul>
      <li>name 本条cookie的键名</li>
      <li>value 可以用encodeURIComponent()来保证它不包含任何逗号、分号或空格(cookie值中禁止使用这些值).</li>
    </ul>
  </li>
</ul>

<h4 id="传输与解析">传输与解析</h4>

<p>HTTP请求时浏览器自动通过Request的headers.Cookie传输给服务器，服务器通过Response的headers里的多条Set-cookie存储到浏览器</p>

<p><img src="/images/6553C236-184C-4A8B-ACCF-397B14764916.png" alt="" />
Response</p>

<p><img src="/images/113CE94D-266E-481A-8AA8-7D0B2CCFC3D9.png" alt="" />
Request</p>

<p>如果符合当前域名和路径下，不同domain不同path下存在相同name的cookie，都会传输，传输顺序按照设置的时间正序排列。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cookie: name=value; name2=value2
</code></pre>
</div>

<p>解析时，如果存在相同name的值，以第一个的值为最终结果。</p>

<p>如果接收到的cookie是<code class="highlighter-rouge">name=value; name=value2</code>，解析的结果是</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">cookies</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span><span class="s1">'value'</span> <span class="p">}</span>
</code></pre>
</div>

<h4 id="相关类库">相关类库</h4>

<h5 id="nodejs">nodejs</h5>

<p>express 官方 <a href="https://www.npmjs.com/package/cookie-parser">cookie-parser</a></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cookie-parser'</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">())</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// get</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Cookies: '</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
  <span class="c1">// set</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'tobi'</span><span class="p">,</span> <span class="p">{</span> <span class="na">domain</span><span class="p">:</span> <span class="s1">'.example.com'</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/admin'</span><span class="p">,</span> <span class="na">secure</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'rememberme'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">,</span> <span class="p">{</span> <span class="na">expires</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">900000</span><span class="p">),</span> <span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="c1">// clear</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">clearCookie</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/admin'</span> <span class="p">});</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span>
</code></pre>
</div>

<p>koa 依赖 <a href="https://www.npmjs.com/package/cookies">cookies</a></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">async</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// get</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">))</span>
  <span class="c1">// set</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'tobi'</span><span class="p">,</span> <span class="p">{</span> <span class="na">domain</span><span class="p">:</span> <span class="s1">'.example.com'</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/admin'</span><span class="p">,</span> <span class="na">secure</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="p">});</span>
</code></pre>
</div>

<h5 id="浏览器">浏览器</h5>

<p><a href="https://www.npmjs.com/package/js-cookie">js-cookie</a></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Create a cookie, valid across the entire site:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">);</span>

<span class="c1">// Create a cookie that expires 7 days from now, valid across the entire site:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="p">{</span> <span class="na">expires</span><span class="p">:</span> <span class="mi">7</span> <span class="p">});</span>

<span class="c1">// Create an expiring cookie, valid to the path of the current page:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="p">{</span> <span class="na">expires</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="s1">''</span> <span class="p">});</span>

<span class="c1">// Read cookie:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span> <span class="c1">// =&gt; 'value'</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'nothing'</span><span class="p">);</span> <span class="c1">// =&gt; undefined</span>

<span class="c1">// Read all visible cookies:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span> <span class="c1">// =&gt; { name: 'value' }</span>

<span class="c1">// Delete cookie:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>

<span class="c1">// Delete a cookie valid to the path of the current page:</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">''</span> <span class="p">});</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span> <span class="c1">// fail!</span>
<span class="nx">Cookies</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">''</span> <span class="p">});</span> <span class="c1">// removed!</span>
</code></pre>
</div>

<h4 id="相关规范">相关规范</h4>

<p><a href="https://tools.ietf.org/html/rfc6265">rfc6265</a></p>

<h3 class="t60" id="所有相关文章">所有<code class="highlighter-rouge">http</code>相关文章</h3>

<ul class="side-nav">

  

    
      <li><a href="http://localhost:4000/fe/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96/">浏览器前端优化 &middot; <strong>浏览器</strong></a></li>
    
      <li><a href="http://localhost:4000/fe/introduction-about-cookie/">一篇简单的cookie介绍 &middot; <strong>Cookie简介</strong></a></li>
    

  
</ul>


			</div>

			
						<div id="page-meta" class="t30">
				<p>
					<!-- Look the author details up from the site config. -->
					
					<!-- Output author details if some exist. -->
					
					<span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="pr20 icon-edit"><a href="http://phlow.de/" target="_blank"> Phlow</a></span>
				</span>
				

				
				<time class="icon-calendar pr20" datetime="2017-07-24T00:00:00+08:00" itemprop="datePublished"> 2017-07-24</time>
				

				<span class="icon-archive pr20"> FE</span>
				<br />
				<span class="pr20"><span class="icon-price-tag pr10"> http</span> </span>
			</p>

			
			<div id="post-nav" class="row">
				
				<div class="small-5 columns"><a class="button small radius prev" href="http://localhost:4000/ux/header-full-width-image-2/">&laquo; Header with a Full-Width-Image</a></div><!-- /.small-4.columns -->
				
				<div class="small-2 columns text-center"><a class="radius button small" href="http://localhost:4000/blog/archive/" title="Blog Archive">Archive</a></div><!-- /.small-4.columns -->
				
				<div class="small-5 columns text-right"><a class="button small radius next" href="http://localhost:4000/fe/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96/">浏览器 &raquo;</a></div><!-- /.small-4.columns -->
				
			</div>
			
			</div><!--  /.page-meta -->

			


		</article>
	</div><!-- /.medium-8.columns -->


	


	
</div><!-- /.row -->


	
	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" href="#top-of-page">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->


    <footer id="footer-content" class="bg-grau">


      <div id="subfooter">
        <nav class="row">
          <section id="subfooter-left" class="small-12 medium-6 columns credits">
            <p>Created with &hearts; by <a href="http://phlow.de/">Phlow</a> with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> based on <a href="http://phlow.github.io/feeling-responsive/">Feeling Responsive</a>.</p>
          </section>
        </nav>
      </div><!-- /#subfooter -->
    </footer>

	

	


<script src="http://localhost:4000/assets/js/javascript.min.js"></script>







</body>
</html>

